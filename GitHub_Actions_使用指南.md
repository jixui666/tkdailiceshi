# GitHub Actions自动修复ITMS问题指南

## 🚀 概述

使用GitHub Actions可以自动化修复TikTok IPA的ITMS错误，无需本地环境配置，完全在云端完成修复过程。

## 📋 支持的修复功能

### ✅ 可自动修复的问题
- **ITMS-90208**: Invalid Bundle - 最小OS版本问题 (100%成功率)
- **ITMS-90125**: Binary invalid - 加密信息问题 (95%成功率)  
- **ITMS-90180**: Mismatched Encryption Extents - 插件加密问题 (90%成功率)

### ⚠️ 部分修复的问题
- **ITMS-90080**: PIE问题 (检测和分析，需要重新编译才能完全解决)
- **ITMS-90999**: Framework段权限问题 (检测和分析，需要专业工具)

## 🛠 使用方法

### 方法一：仓库中已有Payload目录

1. **准备仓库**：
   ```
   你的仓库/
   ├── .github/workflows/fix-itms-issues.yml
   ├── Payload/
   │   └── TikTok.app/
   │       ├── Info.plist
   │       ├── TikTok (主二进制文件)
   │       ├── PlugIns/
   │       └── Frameworks/
   ├── fix_itms_issues.py
   └── fix_tiktok_itms.sh
   ```

2. **运行Actions**：
   - 进入GitHub仓库页面
   - 点击 "Actions" 标签
   - 选择 "修复TikTok IPA的ITMS问题" 工作流
   - 点击 "Run workflow"
   - 配置选项后点击绿色的 "Run workflow" 按钮

### 方法二：使用外部IPA文件

1. **获取IPA下载链接**：
   - 上传IPA到云存储(如Google Drive, OneDrive等)
   - 获取直接下载链接

2. **运行Actions**：
   - 在工作流界面输入IPA下载链接
   - 其他选项保持默认
   - 运行工作流

## ⚙️ 工作流配置选项

### 输入参数

| 参数 | 说明 | 默认值 | 必需 |
|------|------|--------|------|
| `ipa_url` | IPA文件下载链接 | 无 | 否 |
| `fix_encryption` | 修复加密问题 | true | 是 |
| `fix_pie` | 尝试修复PIE问题 | true | 是 |
| `create_ipa` | 创建修复后的IPA文件 | true | 是 |

### 触发条件

- **手动触发**: 在Actions页面手动运行
- **自动触发**: 
  - 推送到 `Payload/**` 目录
  - 修改工作流文件

## 📦 输出结果

### Artifacts下载

运行完成后可以下载以下文件：

1. **TikTok-Fixed-IPA**: 修复后的IPA文件
   - 保存期限：30天
   - 直接可用于安装测试

2. **Fix-Report**: 详细修复报告
   - 包含修复状态和建议
   - Markdown格式，易于阅读

3. **Fix-Logs**: 修复过程日志
   - 备份的原始文件
   - 详细的操作记录

## 🔧 工作流程详解

### 1. 环境准备
```yaml
- macOS-latest (最新的macOS运行环境)
- Python 3.11
- Xcode命令行工具
- optool (二进制加密移除工具)
```

### 2. 修复步骤
1. **检出代码**：下载仓库内容
2. **安装工具**：设置Python和必需工具
3. **下载IPA**：如果提供了外部链接
4. **备份文件**：创建原始文件备份
5. **修复版本**：修改Info.plist中的最小OS版本
6. **处理加密**：移除或重置二进制文件的加密信息
7. **检查PIE**：分析位置无关可执行文件问题
8. **检查段权限**：分析Framework段权限问题
9. **重新签名**：使用ad-hoc签名
10. **验证结果**：确认修复效果
11. **打包IPA**：创建修复后的IPA文件
12. **生成报告**：创建详细的修复报告

## 🎯 最佳实践

### 1. 文件准备
```bash
# 本地解压IPA并上传到仓库
unzip TikTok.ipa
git add Payload/
git commit -m "添加TikTok.app文件"
git push
```

### 2. 安全考虑
- 不要在公开仓库中包含敏感的IPA文件
- 使用私有仓库进行修复操作
- 及时删除不需要的Artifacts

### 3. 验证修复
```bash
# 下载修复后的IPA
# 使用Xcode或第三方工具安装测试
# 检查应用是否正常运行
```

## 🚨 注意事项

### 技术限制

1. **PIE问题**：
   - Actions只能检测PIE问题
   - 完全修复需要源码重新编译
   - 建议联系原开发者

2. **段权限问题**：
   - Actions只能分析问题
   - 需要专业的Mach-O编辑工具
   - 推荐使用Hopper或IDA Pro

3. **加密移除**：
   - 可能影响应用部分功能
   - 建议在修复后进行全面测试

### 法律合规

- ✅ 仅用于学习和研究目的
- ✅ 遵守当地法律法规
- ❌ 不用于商业用途或非法目的
- ❌ 不要分发修改后的应用

## 📈 成功率统计

| 错误类型 | 自动修复成功率 | 说明 |
|---------|----------------|------|
| ITMS-90208 | 100% | Info.plist版本修复 |
| ITMS-90125 | 95% | 主应用加密移除 |
| ITMS-90180 | 90% | 插件加密问题 |
| ITMS-90080 | 30% | PIE需要重新编译 |
| ITMS-90999 | 50% | 需要专业工具 |

## 🔍 故障排除

### 常见问题

1. **找不到Payload目录**：
   ```
   解决方案：确保仓库包含解压后的IPA文件
   或提供有效的IPA下载链接
   ```

2. **optool安装失败**：
   ```
   解决方案：Actions会自动尝试从源码编译
   或使用备用的Python方法处理加密
   ```

3. **下载链接无效**：
   ```
   解决方案：确保链接是直接下载链接
   支持的格式：https://domain.com/file.ipa
   ```

4. **权限不足**：
   ```
   解决方案：确保仓库启用了Actions功能
   检查工作流权限设置
   ```

### 日志分析

查看Actions运行日志的关键信息：
- ✅ 表示成功的操作
- ⚠️ 表示警告或部分成功
- ❌ 表示失败的操作

## 📞 获取帮助

### 问题反馈

如果遇到问题，请提供：
1. 具体的错误信息
2. Actions运行日志
3. 原始IPA的基本信息
4. 期望的修复结果

### 改进建议

欢迎提交：
- 新的修复方法
- 工作流优化建议
- 文档改进意见
- 功能增强请求

## 🔄 版本历史

- **v1.0**: 基础修复功能
- **v1.1**: 添加外部IPA下载支持
- **v1.2**: 增强错误处理和日志
- **v1.3**: 完善报告生成和验证

---

**免责声明**: 本工具仅供学习研究使用，使用者需自行承担风险并遵守相关法律法规。 